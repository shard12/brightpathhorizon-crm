<%
  pageTitle = 'Dashboard';
%>
<%- include('partials/header') %>

<!-- ─── Follow-up Banner ─────────────────────────────────────── -->
<% if (followUps && followUps.length > 0) { %>
<div class="followup-banner">
  <div class="followup-banner-icon">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
    </svg>
  </div>
  <div class="followup-banner-body">
    <strong><%= followUps.length %> follow-up<%= followUps.length > 1 ? 's' : '' %> scheduled today</strong>
    <span>— Don't miss your client check-ins.</span>
  </div>
  <a href="/leads?followup=today" class="followup-banner-cta">View All</a>
</div>
<% } %>

<!-- ─── Welcome Row ─────────────────────────────────────────── -->
<div class="dash-welcome">
  <div>
    <h2 class="dash-greeting">Good <%= (new Date().getHours() < 12 ? 'morning' : new Date().getHours() < 17 ? 'afternoon' : 'evening') %>, <%= user.name.split(' ')[0] %></h2>
    <p class="dash-subtitle">Here's what's happening with your leads today.</p>
  </div>
  <div class="dash-date">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="14" height="14"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
    <%= new Date().toLocaleDateString('en-IN', { weekday:'long', year:'numeric', month:'long', day:'numeric' }) %>
  </div>
</div>

<!-- ─── Stats Cards ──────────────────────────────────────────── -->
<div class="stats-grid">

  <!-- Total Leads -->
  <div class="stat-card">
    <div class="stat-card-body">
      <p class="stat-label">Total Leads</p>
      <div class="stat-value"><%= stats.total || 0 %></div>
    </div>
    <div class="stat-icon cyan">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
        <circle cx="9" cy="7" r="4"/>
        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
      </svg>
    </div>
  </div>

  <!-- New Leads -->
  <div class="stat-card">
    <div class="stat-card-body">
      <p class="stat-label">New Leads</p>
      <div class="stat-value"><%= stats.new_leads || 0 %></div>
    </div>
    <div class="stat-icon blue">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <line x1="12" y1="8" x2="12" y2="16"/>
        <line x1="8" y1="12" x2="16" y2="12"/>
      </svg>
    </div>
  </div>

  <!-- In Progress -->
  <div class="stat-card">
    <div class="stat-card-body">
      <p class="stat-label">In Progress</p>
      <div class="stat-value"><%= stats.in_progress || 0 %></div>
    </div>
    <div class="stat-icon orange">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"/>
        <polyline points="12 6 12 12 16 14"/>
      </svg>
    </div>
  </div>

  <!-- Closed -->
  <div class="stat-card">
    <div class="stat-card-body">
      <p class="stat-label">Closed</p>
      <div class="stat-value stat-value-green"><%= stats.closed || 0 %></div>
    </div>
    <div class="stat-icon green">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
        <polyline points="22 4 12 14.01 9 11.01"/>
      </svg>
    </div>
  </div>

</div>

<!-- ─── Bottom Grid ───────────────────────────────────────────── -->
<div class="dash-grid">

  <!-- Today's Follow-Ups -->
  <div class="card">
    <div class="card-header">
      <div class="card-title-group">
        <div class="card-title-icon orange-light">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
          </svg>
        </div>
        <h3 class="card-title">Today's Follow-Ups</h3>
      </div>
      <a href="/leads?followup=today" class="btn btn-ghost btn-sm">View All</a>
    </div>

    <% if (followUps.length === 0) { %>
      <div class="empty-state">
        <div class="empty-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="36" height="36">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
            <polyline points="22 4 12 14.01 9 11.01"/>
          </svg>
        </div>
        <p>All clear! No follow-ups scheduled for today.</p>
      </div>
    <% } else { %>
      <div class="followup-list">
        <% followUps.forEach(lead => { %>
        <div class="followup-item">
          <div class="followup-avatar"><%= lead.name.charAt(0).toUpperCase() %></div>
          <div class="followup-details">
            <div class="followup-name"><%= lead.name %></div>
            <div class="followup-contact"><%= lead.phone || lead.email || '—' %></div>
          </div>
          <a href="/leads/<%= lead.id %>/edit" class="btn btn-warning btn-sm">Follow Up</a>
        </div>
        <% }) %>
      </div>
    <% } %>
  </div>

  <!-- Recent Leads -->
  <div class="card">
    <div class="card-header">
      <div class="card-title-group">
        <div class="card-title-icon blue-light">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <h3 class="card-title">Recent Leads</h3>
      </div>
      <a href="/leads" class="btn btn-ghost btn-sm">View All</a>
    </div>

    <% if (recentLeads.length === 0) { %>
      <div class="empty-state">
        <div class="empty-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" width="36" height="36">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
          </svg>
        </div>
        <p>No leads yet. Add your first lead to get started.</p>
        <a href="/leads/new" class="btn btn-primary btn-sm" style="margin-top:12px;">Add Lead</a>
      </div>
    <% } else { %>
      <div class="recent-leads-list">
        <% recentLeads.forEach(lead => { %>
        <div class="recent-lead-item">
          <div class="recent-lead-avatar"><%= lead.name.charAt(0).toUpperCase() %></div>
          <div class="recent-lead-info">
            <div class="recent-lead-name"><%= lead.name %></div>
            <div class="recent-lead-meta">
              <span class="source-tag"><%= lead.source %></span>
              <span><%= lead.bde_name || 'Unassigned' %></span>
            </div>
          </div>
          <span class="badge <%=
            lead.status === 'New' ? 'badge-new' :
            lead.status === 'In Progress' ? 'badge-progress' :
            'badge-closed'
          %>"><%= lead.status %></span>
        </div>
        <% }) %>
      </div>
    <% } %>
  </div>

</div><!-- /.dash-grid -->

<%- include('partials/footer') %>