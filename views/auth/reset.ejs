<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password | BrightPathHorizon CRM</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">
  <style>
    /* â”€â”€ Step indicator â”€â”€ */
    .auth-step {
      display: flex; align-items: center; gap: 8px;
      font-size: 11.5px; font-weight: 600; color: #9ca3af;
      letter-spacing: .4px; text-transform: uppercase;
      margin-bottom: 22px;
    }
    .auth-step-dot {
      width: 20px; height: 20px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; font-weight: 800;
    }
    .auth-step-dot.done     { background: #10b981; color: #fff; }
    .auth-step-dot.active   { background: #111827; color: #fff; }
    .auth-step-dot.inactive { background: #f3f4f6; color: #9ca3af; }
    .auth-step-line { flex: 1; height: 1px; }
    .auth-step-line.done { background: #10b981; }
    .auth-step-line.inactive { background: #e5e7eb; }

    /* â”€â”€ Forgot icon â”€â”€ */
    .reset-icon-wrap {
      width: 56px; height: 56px; border-radius: 16px;
      background: #f0fdf4; display: flex; align-items: center; justify-content: center;
      margin-bottom: 22px;
    }

    /* â”€â”€ Password strength bar â”€â”€ */
    .strength-wrap { margin-top: -8px; margin-bottom: 16px; }
    .strength-bars { display: flex; gap: 4px; margin-bottom: 5px; }
    .strength-bar {
      flex: 1; height: 3px; border-radius: 4px; background: #e5e7eb;
      transition: background .3s;
    }
    .strength-bar.weak   { background: #ef4444; }
    .strength-bar.medium { background: #f59e0b; }
    .strength-bar.strong { background: #10b981; }
    .strength-label {
      font-size: 11.5px; font-weight: 600; color: #9ca3af;
      transition: color .3s;
    }
    .strength-label.weak   { color: #ef4444; }
    .strength-label.medium { color: #f59e0b; }
    .strength-label.strong { color: #10b981; }

    /* â”€â”€ Requirements checklist â”€â”€ */
    .req-list { display: flex; flex-direction: column; gap: 6px; margin-bottom: 20px; }
    .req-item {
      display: flex; align-items: center; gap: 8px;
      font-size: 12px; color: #9ca3af; transition: color .25s;
    }
    .req-item.met { color: #10b981; }
    .req-dot {
      width: 16px; height: 16px; border-radius: 50%;
      border: 1.5px solid #d1d5db; display: flex; align-items: center; justify-content: center;
      flex-shrink: 0; transition: background .25s, border-color .25s;
    }
    .req-item.met .req-dot { background: #10b981; border-color: #10b981; }
    .req-dot svg { display: none; }
    .req-item.met .req-dot svg { display: block; }

    /* â”€â”€ Password toggle â”€â”€ */
    .input-wrap { position: relative; }
    .input-wrap .input-icon {
      position: absolute; left: 2px; top: 50%; transform: translateY(-50%);
      color: #9ca3af; pointer-events: none;
    }
    .input-with-icon { padding-left: 28px !important; padding-right: 40px !important; }
    .pw-toggle {
      position: absolute; right: 8px; top: 50%; transform: translateY(-50%);
      background: none; border: none; cursor: pointer; color: #9ca3af;
      padding: 4px; display: flex; align-items: center;
      transition: color .18s;
    }
    .pw-toggle:hover { color: #374151; }

    /* â”€â”€ Match indicator â”€â”€ */
    .match-indicator {
      font-size: 11.5px; margin-top: -12px; margin-bottom: 16px;
      display: flex; align-items: center; gap: 5px; min-height: 16px;
    }
    .match-indicator.match   { color: #10b981; }
    .match-indicator.nomatch { color: #ef4444; }

    /* â”€â”€ Left panel â”€â”€ */
    .security-badges {
      display: flex; flex-direction: column; gap: 12px;
      margin-top: auto; padding-top: 32px;
    }
    .security-badge {
      display: flex; align-items: center; gap: 12px;
      background: rgba(255,255,255,0.07); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 11px; padding: 12px 16px;
    }
    .security-badge-icon {
      width: 34px; height: 34px; border-radius: 9px;
      background: rgba(255,255,255,0.12); color: #fff;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .security-badge-text { font-size: 12.5px; color: rgba(255,255,255,0.82); line-height: 1.45; }
    .security-badge-text strong { color: #fff; font-weight: 700; }

    /* â”€â”€ Success state â”€â”€ */
    .success-state { display: none; text-align: center; }
    .success-state.visible { display: block; }
    .form-state.hidden { display: none; }
    .success-ring {
      width: 68px; height: 68px; border-radius: 50%;
      background: #ecfdf5; border: 2px solid #bbf7d0;
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px; color: #10b981;
      animation: popIn .4s cubic-bezier(.17,.67,.38,1.4);
    }
    @keyframes popIn { from { transform: scale(0.6); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body class="split-auth">
<div class="split-container">

  <!-- LEFT PANEL -->
  <div class="left-panel">
    <div class="curves"></div>
    <div class="left-content">

      <div class="left-logo">
        <a href="https://www.brightpathhorizon.com" target="_blank">
          <img src="/images/bphlogo.png" alt="BrightPath Logo">
        </a>
      </div>

      <h1 style="margin-top:8vh;">Set a New<br>Password ðŸ”’</h1>

      <p>Choose a strong password to protect your CRM account. Use a mix of letters, numbers, and symbols for the best security.</p>

      <div class="security-badges">
        <div class="security-badge">
          <div class="security-badge-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <div class="security-badge-text"><strong>256-bit encryption</strong><br>Your data is always protected</div>
        </div>
        <div class="security-badge">
          <div class="security-badge-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          </div>
          <div class="security-badge-text"><strong>Hashed with bcrypt</strong><br>Passwords never stored in plain text</div>
        </div>
        <div class="security-badge">
          <div class="security-badge-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="16" height="16"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
          </div>
          <div class="security-badge-text"><strong>Link expires in 1 hour</strong><br>One-time use only for safety</div>
        </div>
      </div>

    </div>
    <div class="left-footer">
      Â© <%= new Date().getFullYear() %> BrightPathHorizon Technologies
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right-panel" style="position:relative;">

    <div class="login-box" style="max-width:360px;">

      <!-- Step indicator -->
      <div class="auth-step">
        <div class="auth-step-dot done">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="10" height="10"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="auth-step-line done"></div>
        <div class="auth-step-dot done">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="10" height="10"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="auth-step-line done"></div>
        <div class="auth-step-dot active">3</div>
      </div>

      <!-- Form state -->
      <div class="form-state" id="formState">

        <div class="reset-icon-wrap">
          <svg viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="26" height="26">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
          </svg>
        </div>

        <h2 style="font-size:13px;font-weight:600;color:#6b7280;margin-bottom:6px;">BrightPath CRM</h2>
        <h3 style="font-size:26px;font-weight:800;color:#111827;letter-spacing:-.5px;margin-bottom:8px;">Create new password</h3>
        <p style="font-size:13px;color:#6b7280;line-height:1.6;margin-bottom:26px;">Your reset link is valid. Choose a strong password you haven't used before.</p>

        <% if (typeof error !== 'undefined' && error && error.length > 0) { %>
          <% error.forEach(msg => { if(msg) { %>
            <div class="login-error" style="margin-bottom:16px;display:flex;align-items:center;gap:8px;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="14" height="14" style="flex-shrink:0;"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
              <%= msg %>
            </div>
          <% } }) %>
        <% } %>

        <form method="POST" id="resetForm" onsubmit="handleSubmit(event)">
          <!-- New password -->
          <div class="input-wrap" style="margin-bottom:8px;">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            <input
              class="input-with-icon"
              type="password"
              name="password"
              id="newPassword"
              placeholder="New password"
              required
              oninput="checkStrength(this.value); checkMatch();"
            >
            <button type="button" class="pw-toggle" onclick="togglePw('newPassword', this)">
              <svg id="eyeNew" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>

          <!-- Strength -->
          <div class="strength-wrap">
            <div class="strength-bars">
              <div class="strength-bar" id="sb1"></div>
              <div class="strength-bar" id="sb2"></div>
              <div class="strength-bar" id="sb3"></div>
              <div class="strength-bar" id="sb4"></div>
            </div>
            <span class="strength-label" id="strengthLabel">Enter a password</span>
          </div>

          <!-- Requirements -->
          <div class="req-list">
            <div class="req-item" id="req-len">
              <div class="req-dot"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="9" height="9"><polyline points="20 6 9 17 4 12"/></svg></div>
              At least 8 characters
            </div>
            <div class="req-item" id="req-upper">
              <div class="req-dot"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="9" height="9"><polyline points="20 6 9 17 4 12"/></svg></div>
              One uppercase letter
            </div>
            <div class="req-item" id="req-num">
              <div class="req-dot"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="9" height="9"><polyline points="20 6 9 17 4 12"/></svg></div>
              One number
            </div>
            <div class="req-item" id="req-sym">
              <div class="req-dot"><svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" width="9" height="9"><polyline points="20 6 9 17 4 12"/></svg></div>
              One special character
            </div>
          </div>

          <!-- Confirm password -->
          <div class="input-wrap" style="margin-bottom:6px;">
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
            <input
              class="input-with-icon"
              type="password"
              name="confirmPassword"
              id="confirmPassword"
              placeholder="Confirm new password"
              required
              oninput="checkMatch()"
            >
            <button type="button" class="pw-toggle" onclick="togglePw('confirmPassword', this)">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>

          <div class="match-indicator" id="matchIndicator"></div>

          <button type="submit" class="login-btn" id="submitBtn" style="display:flex;align-items:center;justify-content:center;gap:8px;">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" width="15" height="15"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
            Update Password
          </button>

        </form>

        <a href="/auth/login" style="display:inline-flex;align-items:center;gap:7px;font-size:13px;color:#6b7280;font-weight:500;margin-top:20px;text-decoration:none;transition:color .18s;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="13" height="13"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
          Back to Login
        </a>

      </div>

      <!-- Success state -->
      <div class="success-state" id="successState">
        <div class="success-ring">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="28" height="28"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        </div>
        <h3 style="font-size:24px;font-weight:800;color:#111827;letter-spacing:-.4px;margin-bottom:8px;">Password updated!</h3>
        <p style="font-size:13.5px;color:#6b7280;line-height:1.65;margin-bottom:24px;">Your password has been reset successfully. You can now log in with your new credentials.</p>
        <a href="/auth/login" class="login-btn" style="display:inline-flex;align-items:center;justify-content:center;gap:8px;text-decoration:none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" width="14" height="14"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Go to Login
        </a>
      </div>

    </div><!-- /.login-box -->

    <!-- Contact -->
    <p style="position:absolute;bottom:24px;left:0;right:0;text-align:center;font-size:12px;color:#9ca3af;font-family:'Plus Jakarta Sans',sans-serif;">
      Need help? <a href="mailto:contact@brightpathhorizon.com" style="color:#6b7280;font-weight:600;text-decoration:underline;text-underline-offset:3px;">contact@brightpathhorizon.com</a>
    </p>

  </div><!-- /.right-panel -->
</div><!-- /.split-container -->

<script>
function togglePw(id, btn) {
  const inp = document.getElementById(id);
  if (inp.type === 'password') {
    inp.type = 'text';
    btn.style.color = '#374151';
  } else {
    inp.type = 'password';
    btn.style.color = '#9ca3af';
  }
}

function checkStrength(val) {
  const bars = [document.getElementById('sb1'), document.getElementById('sb2'), document.getElementById('sb3'), document.getElementById('sb4')];
  const label = document.getElementById('strengthLabel');
  bars.forEach(b => { b.className = 'strength-bar'; });

  let score = 0;
  if (val.length >= 8) score++;
  if (/[A-Z]/.test(val)) score++;
  if (/[0-9]/.test(val)) score++;
  if (/[^A-Za-z0-9]/.test(val)) score++;

  // Requirements
  document.getElementById('req-len').classList.toggle('met', val.length >= 8);
  document.getElementById('req-upper').classList.toggle('met', /[A-Z]/.test(val));
  document.getElementById('req-num').classList.toggle('met', /[0-9]/.test(val));
  document.getElementById('req-sym').classList.toggle('met', /[^A-Za-z0-9]/.test(val));

  if (!val) { label.className = 'strength-label'; label.textContent = 'Enter a password'; return; }
  if (score <= 1) {
    bars[0].className = 'strength-bar weak';
    label.className = 'strength-label weak'; label.textContent = 'Weak';
  } else if (score === 2) {
    bars[0].className = bars[1].className = 'strength-bar medium';
    label.className = 'strength-label medium'; label.textContent = 'Fair';
  } else if (score === 3) {
    bars[0].className = bars[1].className = bars[2].className = 'strength-bar strong';
    label.className = 'strength-label strong'; label.textContent = 'Good';
  } else {
    bars.forEach(b => b.className = 'strength-bar strong');
    label.className = 'strength-label strong'; label.textContent = 'âœ“ Strong';
  }
}

function checkMatch() {
  const pw = document.getElementById('newPassword').value;
  const cf = document.getElementById('confirmPassword').value;
  const ind = document.getElementById('matchIndicator');
  if (!cf) { ind.textContent = ''; ind.className = 'match-indicator'; return; }
  if (pw === cf) {
    ind.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="12" height="12"><polyline points="20 6 9 17 4 12"/></svg> Passwords match`;
    ind.className = 'match-indicator match';
  } else {
    ind.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" width="12" height="12"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg> Passwords don't match`;
    ind.className = 'match-indicator nomatch';
  }
}

function handleSubmit(e) {
  const pw = document.getElementById('newPassword').value;
  const cf = document.getElementById('confirmPassword').value;
  if (pw !== cf) { e.preventDefault(); checkMatch(); return; }

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  btn.innerHTML = `
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round" width="15" height="15" style="animation:spin .7s linear infinite;"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
    Updating...
  `;
}
</script>
</body>
</html>